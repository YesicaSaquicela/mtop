<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ocp="http://java.sun.com/jsf/composite/ocpcommon"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:s="http://jboss.org/seam/faces"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions">

    <ui:composition template="/WEB-INF/view/templates/glue.xhtml">
        <f:metadata>
            <f:viewParam name="balancedScorecardId" value="#{balancedScorecardHome.balancedScorecardId}" />
        </f:metadata>
        <ui:param name="title" value="#{balancedScorecardHome.instance.name}" />
        <ui:define name="header-replace">
            <div style="width: 100%; background-color: #FFF5E3; margin-bottom: 10px; ">
                <div class="container">
                    <div class="row fluid" style="margin-top: 5px;">
                        <div class="span9 ">
                            <h2>#{balancedScorecardHome.managed ? balancedScorecardHome.instance.name : ""}</h2>
                            <p><span style="">#{messages['common.in']} #{balancedScorecardHome.organization.name}</span>
                            </p>
                        </div>
                        <div class="span3 ">
                            <h:form id="control">                                
                                <br/>
                                <h:link outcome="/pages/management/balancedscorecard/list" styleClass="link" value="#{messages['common.cancel']}">
                                    <f:param  name="organizationId" value="#{balancedScorecardHome.instance.organization.id}"></f:param>
                                </h:link>
                                <br/>
                                <h:link value="#{messages['panel.admin']} " rendered="#{true}" 
                                        outcome="/pages/home.xhtml?faces-redirect=true" styleClass="link">                                
                                </h:link>
                            </h:form>
                        </div>

                    </div>
                </div></div>             
        </ui:define>
        <div class="row-fluid">             
            <ui:define name="sidebar">
                <h:form id="view"> 
                    <!--<p:contextMenu for="bscTree" >  
                        <p:menuitem value="#{messages['common.add']}" update=":viewtable:messages" actionListener="#{balancedScorecardHome.redirecToAdd}" icon="ui-icon-plus" /> 
                        <p:menuitem value="#{messages['common.edit']}" update=":viewtable:messages" actionListener="#{balancedScorecardHome.redirecToEdit}" icon="ui-icon-plus" /> 
                    </p:contextMenu>  -->
                    <p:panel id="explorer-panel"  header="#{messages['common.explorer']}" toggleable="true" >
                        <p:tree id="bscTree"  value="#{balancedScorecardHome.bscNode}" var="node"
                                selectionMode="single" selection="#{balancedScorecardHome.selectedNode}">  

                            <p:ajax event="select" update=":viewtable:messages :viewtable:button-add :viewtable:button-edit :viewtable:detail-panel" listener="#{balancedScorecardHome.onNodeSelect}" /> 
                            <p:treeNode expandedIcon="ui-icon-folder-open"  
                                        collapsedIcon="ui-icon-folder-collapsed">  
                            </p:treeNode>  
                            <p:treeNode  type="bsc" icon="ui-icon-home">    
                                <h:outputText value="#{node.name}" />  
                            </p:treeNode>  
                            <p:treeNode  type="perspective" icon="ui-icon-lightbulb">    
                                <h:outputText value="#{node.name}" />  
                            </p:treeNode>  
                            <p:treeNode  type="theme" icon="ui-icon-key">    
                                <h:outputText value="#{node.name}" />  
                            </p:treeNode>  
                            <p:treeNode type="objetive" icon="ui-icon-flag">  
                                <h:outputText value="#{node.name}" />  
                            </p:treeNode>
                            <p:treeNode type="measure" icon="ui-icon-battery-2">  
                                <h:outputText value="#{node.name}" />  
                            </p:treeNode>                        
                            <p:treeNode type="target" icon="ui-icon-check">  
                                <h:outputText value="#{node.name}" />  
                            </p:treeNode>
                        </p:tree>
                   </p:panel> 
                </h:form>

            </ui:define>
            <ui:define name="content">
                <h:form id="viewtable" >
                    <p:messages id="messages" showDetail="true" autoUpdate="true" closable="true"/>
                    <div class="form-actions" style="padding-left: 20px">                            
                        <p:commandLink id="button-add" value="#{messages['common.add']}" update=":viewtable:messages" actionListener="#{balancedScorecardHome.redirecToAdd}" styleClass="btn btn-primary" disabled="#{empty balancedScorecardHome.selectedNode}"/>
                        #{'  '}
                        <p:commandLink id="button-edit" value="#{messages['common.edit']}" update=":viewtable:messages" actionListener="#{balancedScorecardHome.redirecToEdit}" disabled="#{empty balancedScorecardHome.selectedNode}" styleClass="btn btn-secondary"/>
                    </div>
                    <p:panel id="detail-panel" header="#{balancedScorecardHome.selectedNode.data.name!=null? balancedScorecardHome.selectedNode.data.name: balancedScorecardHome.bscNode.data.name}" toggleable="true">

                        <p:treeTable id="treetable" value="#{balancedScorecardHome.selectedNode!=null?balancedScorecardHome.selectedNode:balancedScorecardHome.bscNode}" var="node"  propagateSelectionUp="true">  

                            <p:column headerText="#{messages['module.balancedscorecard.dimention']}">  
                                <h:outputText value="#{balancedScorecardHome.getToHaveChildren(balancedScorecardHome.selectedNode!=null?balancedScorecardHome.selectedNode:balancedScorecardHome.bscNode) == true ? node: hola}"/>                        
                            </p:column>  
                            <p:column headerText="#{messages['common.period.from']}">  
                                <h:outputText value="#{node.from}" rendered="#{node.class.name.equals('org.eqaula.glue.model.management.Target')}">
                                    <f:convertDateTime type="date" pattern="dd-MM-yyyy"/>
                                </h:outputText>

                            </p:column>
                            <p:column headerText="#{messages['common.period.to']}">  
                                <h:outputText value="#{node.to}" rendered="#{node.class.name.equals('org.eqaula.glue.model.management.Target')}">
                                    <f:convertDateTime type="date" pattern="dd-MM-yyyy"/>
                                </h:outputText>  
                            </p:column>
                            <p:column headerText="#{messages['common.type']}">  
                                <h:outputText value="#{messages[node.targetType]}" rendered="#{node.class.name.equals('org.eqaula.glue.model.management.Target')}"/>  
                            </p:column>
                            <p:column headerText="#{messages['common.expectedValue']}">  
                                <h:outputText value="#{node.value}" rendered="#{node.class.name.equals('org.eqaula.glue.model.management.Target')}"/>  
                            </p:column>
                            <p:column headerText="#{messages['common.currentValue']}">  
                                <h:outputText value="#{node.currentValue}" rendered="#{node.class.name.equals('org.eqaula.glue.model.management.Target')}"/>  
                            </p:column>
                            <p:column headerText="#{messages['common.variance']}">  
                                <h:outputText value="#{node.currentValue - node.value}" rendered="#{node.class.name.equals('org.eqaula.glue.model.management.Target')}"/>  
                            </p:column>
                            <p:column headerText="#{messages['common.unit']}">  
                                <h:outputText value="#{node.measure.unit}" rendered="#{node.class.name.equals('org.eqaula.glue.model.management.Target')}"/>  
                            </p:column>
                            <p:column headerText="#{messages['module.method']}">  
                                <p:dataTable var="method" value="#{node.methods}" rendered="#{node.class.name.equals('org.eqaula.glue.model.management.Target')}">
                                    <p:column>
                                        <p:graphicImage value="/MethodPrinter?methodId=#{methodPrinter.printToDownload(balancedScorecardHome.runMethod(method)).id}" rendered="#{node.class.name.equals('org.eqaula.glue.model.management.Target')}"/>
                                    </p:column>
                                </p:dataTable>
                            </p:column>
                        </p:treeTable>  
                    </p:panel>    
                </h:form>
            </ui:define>
        </div>
    </ui:composition>
</html>
